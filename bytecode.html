<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Bytecode &#8212; Any-VM 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/better.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Runtime" href="runtime.html" />
    <link rel="prev" title="API Reference" href="api.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head>
  <body role="document">
    <header id="pageheader"><h1><a href="index.html ">
        Any-VM 0.1.0 documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="api.html" title="Previous document">API Reference</a>
        </li>
        <li>
          <a href="runtime.html" title="Next document">Runtime</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">Any-VM 0.1.0 documentation</a></li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="bytecode">
<h1>Bytecode<a class="headerlink" href="#bytecode" title="Permalink to this headline">¶</a></h1>
<div class="section" id="code-chunk">
<h2>Code Chunk<a class="headerlink" href="#code-chunk" title="Permalink to this headline">¶</a></h2>
<dl class="struct">
<dt id="c.achunk_t">
<span class="target" id="any-vmstructachunk__t"></span><em class="property">struct </em><code class="descname">achunk_t</code><a class="headerlink" href="#c.achunk_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Bytecode chunk. </p>
<p>Layout: [<code class="docutils literal"><span class="pre">header</span></code>] [<code class="docutils literal"><span class="pre">module</span> <span class="pre">prototype</span></code>].</p>
<p>AVM is dynamic, stack based abstract machine which rely on a strong coupled, relocatable and recursive intermediate representation called <code class="docutils literal"><span class="pre">bytecode</span> <span class="pre">chunk</span></code>. That designed to be loaded and executed directly from the storages with as least effort as possible.</p>
<p>The bytecode chunk includes everything we need for a module to be executed except the imports. This chunk is portable in theory, however there&#8217;s no need to actually do that in real-life. AVM will not even try to make any effort to load an incompatible chunks. Of course, if we really <strong>need</strong> this feature, a bytecode rewriter can always be implemented as an external tool.</p>
<p><dl class="docutils">
<dt><strong>Header format.</strong></dt>
<dd><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="44%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">bytes</th>
<th class="head">description</th>
<th class="head">value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4</td>
<td>signature</td>
<td>0x41 0x6E 0x79 0x00</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>version number</td>
<td>0x{MAJOR}{MINOR}</td>
</tr>
<tr class="row-even"><td>1</td>
<td>is big endian?</td>
<td>1 = big, 0 = little</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>size of size_t</td>
<td>default 8 bytes</td>
</tr>
<tr class="row-even"><td>1</td>
<td>size of integer</td>
<td>default 8 bytes</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>size of float</td>
<td>default 8 bytes</td>
</tr>
<tr class="row-even"><td>1</td>
<td>size of instruction</td>
<td>always 4</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>_</td>
<td>_</td>
</tr>
</tbody>
</table>
</dd>
<dt><strong>Note</strong></dt>
<dd>The header portion is not affected by endianess. </dd>
</dl>
</p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt>
<span class="target" id="any-vmstructachunk__t_1a08381890e0a8647021b6eae21f1524a8"></span><code class="descname">uint8_t achunk_t::signature[4]</code></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::major_ver">
<span class="target" id="any-vmstructachunk__t_1a8814e221ec5537d7ab1e1cf3a7e1abe2"></span>uint32_t <code class="descname">major_ver</code><a class="headerlink" href="#c.achunk_t::major_ver" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::minor_ver">
<span class="target" id="any-vmstructachunk__t_1a3376438ff63cae0ac0104da803a485f2"></span>uint32_t <code class="descname">minor_ver</code><a class="headerlink" href="#c.achunk_t::minor_ver" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::big_endian">
<span class="target" id="any-vmstructachunk__t_1a773f9e0a212c4c744b2838e547823692"></span>uint32_t <code class="descname">big_endian</code><a class="headerlink" href="#c.achunk_t::big_endian" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::size_of_size_t">
<span class="target" id="any-vmstructachunk__t_1aa8df4dc8a97f5d55a6ed747b597f5a4c"></span>uint32_t <code class="descname">size_of_size_t</code><a class="headerlink" href="#c.achunk_t::size_of_size_t" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::size_of_integer">
<span class="target" id="any-vmstructachunk__t_1a9ae9ea5c185284cc342717dd7f1de652"></span>uint32_t <code class="descname">size_of_integer</code><a class="headerlink" href="#c.achunk_t::size_of_integer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::size_of_float">
<span class="target" id="any-vmstructachunk__t_1ab73fe04a9028bfd62ae856cc24c2ca87"></span>uint8_t <code class="descname">size_of_float</code><a class="headerlink" href="#c.achunk_t::size_of_float" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.achunk_t::size_of_instruction">
<span class="target" id="any-vmstructachunk__t_1a62389f04d649cb85ea5970278007ca85"></span>uint8_t <code class="descname">size_of_instruction</code><a class="headerlink" href="#c.achunk_t::size_of_instruction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="function-prototype">
<h2>Function Prototype<a class="headerlink" href="#function-prototype" title="Permalink to this headline">¶</a></h2>
<dl class="struct">
<dt id="c.aprototype_t">
<span class="target" id="any-vmstructaprototype__t"></span><em class="property">struct </em><code class="descname">aprototype_t</code><a class="headerlink" href="#c.aprototype_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Function prototype. </p>
<p>This struct represents the header portion of a function prototype. Each prototype is self-contained and relocatable, all references are relative to their corresponding header. That means we can safety copy a memory blob of prototype and move it around, save to and loaded from disk without any need for patching.</p>
<p>The first prototype in chunk is <code class="docutils literal"><span class="pre">module</span> <span class="pre">prototype</span></code>, which is unable to be executed. There are no instructions, upvalues, arguments, constants, local variables and imports in this kind of prototype. All nesteds of that will be treated as <code class="docutils literal"><span class="pre">module</span> <span class="pre">function</span></code>. Which can&#8217;t accept upvalues and will be exported as the name specified in the <code class="docutils literal"><span class="pre">symbol</span></code> field. That allow such functions to be imported later by other modules.</p>
<p>In AVM, there are two kind of string, <code class="docutils literal"><span class="pre">static</span></code> and <code class="docutils literal"><span class="pre">collectable</span></code>. Compile time strings are <code class="docutils literal"><span class="pre">static</span></code> and must be referenced by <code class="docutils literal"><span class="pre">astring_ref_t</span></code> which is just an offset to the dedicated <strong>per prototype</strong> string pool. We don&#8217;t want to share these pools between prototype to make relocating trivial.</p>
<p>To reduce the loading time and make memory management simpler, prototype must be able to loaded from the storages as-is by just a single read. No more memory allocation are required. The prototype format itself reserved few bytes to be used by the runtime. Remember that, despite being called <code class="docutils literal"><span class="pre">bytecode</span></code>, we don&#8217;t prefer polite and portable bytecode over performance and simplicity. For each platform, you are expected to run the compiler or rewriter again.The runtime is stupid and don&#8217;t want to take challenges. The best things that AVM runtime provides is just sandbox guarantees, by prevent malformed bytecode to crash the system, nothing more.</p>
<p><dl class="docutils">
<dt><strong>Memory layout:</strong></dt>
<dd><table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="37%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">bytes</th>
<th class="head">description</th>
<th class="head">scope</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4 signed</td>
<td>source file name</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>4 signed</td>
<td>to be exported</td>
<td>_</td>
</tr>
<tr class="row-even"><td>4 signed</td>
<td>num of string bytes</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>4 signed</td>
<td>num of instructions</td>
<td>_</td>
</tr>
<tr class="row-even"><td>2 signed</td>
<td>num of nesteds</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>1 unsigned</td>
<td>num of upvalues</td>
<td>_</td>
</tr>
<tr class="row-even"><td>1 unsigned</td>
<td>num of arguments</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>1 unsigned</td>
<td>num of constants</td>
<td>_</td>
</tr>
<tr class="row-even"><td>1 unsigned</td>
<td>num of local variables</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>1 unsigned</td>
<td>num of imports</td>
<td>_</td>
</tr>
<tr class="row-even"><td>1</td>
<td>_</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>sizeof(<a class="reference internal" href="#c.acurrent_t" title="acurrent_t"><code class="xref c c-type docutils literal"><span class="pre">acurrent_t</span></code></a>)</td>
<td>resolved pointers</td>
<td>runtime</td>
</tr>
<tr class="row-even"><td>num of string bytes</td>
<td>pool of strings</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>n * sizeof(<a class="reference internal" href="#c.ainstruction_t" title="ainstruction_t"><code class="xref c c-type docutils literal"><span class="pre">ainstruction_t</span></code></a>)</td>
<td>pool of instructions</td>
<td>_</td>
</tr>
<tr class="row-even"><td>n * sizeof(<a class="reference internal" href="runtime.html#c.avalue_t" title="avalue_t"><code class="xref c c-type docutils literal"><span class="pre">avalue_t</span></code></a>)</td>
<td>pool of constants</td>
<td>_</td>
</tr>
<tr class="row-odd"><td>n * sizeof(<a class="reference internal" href="#c.aimport_t" title="aimport_t"><code class="xref c c-type docutils literal"><span class="pre">aimport_t</span></code></a>)</td>
<td>pool of imports</td>
<td>_</td>
</tr>
<tr class="row-even"><td>n * sizeof(void*)</td>
<td>nested prototype pointers</td>
<td>runtime</td>
</tr>
<tr class="row-odd"><td>_</td>
<td>nested prototypes</td>
<td>_</td>
</tr>
</tbody>
</table>
 </dd>
<dt><strong>Note</strong></dt>
<dd>Portions with <code class="docutils literal"><span class="pre">runtime</span> <span class="pre">scope</span></code> are reversed in compile time. </dd>
</dl>
</p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.aprototype_t::source">
<span class="target" id="any-vmstructaprototype__t_1a61ede5654b9cdd26ead42814a89bdd03"></span>astring_ref_t <code class="descname">source</code><a class="headerlink" href="#c.aprototype_t::source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::symbol">
<span class="target" id="any-vmstructaprototype__t_1a6860489667e934d53a57c51dd9e19759"></span>astring_ref_t <code class="descname">symbol</code><a class="headerlink" href="#c.aprototype_t::symbol" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::strings_sz">
<span class="target" id="any-vmstructaprototype__t_1ac91a26009e901a93631d1c127d1ba3dc"></span>int32_t <code class="descname">strings_sz</code><a class="headerlink" href="#c.aprototype_t::strings_sz" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_instructions">
<span class="target" id="any-vmstructaprototype__t_1ac0390ef2fd986ac0dc396b14a444ed5b"></span>int32_t <code class="descname">num_instructions</code><a class="headerlink" href="#c.aprototype_t::num_instructions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_nesteds">
<span class="target" id="any-vmstructaprototype__t_1a175588b03abf1b84fbfb6179af18a9b4"></span>int16_t <code class="descname">num_nesteds</code><a class="headerlink" href="#c.aprototype_t::num_nesteds" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_upvalues">
<span class="target" id="any-vmstructaprototype__t_1ae77b96ab237b46af51e44334d4d547c3"></span>uint8_t <code class="descname">num_upvalues</code><a class="headerlink" href="#c.aprototype_t::num_upvalues" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_arguments">
<span class="target" id="any-vmstructaprototype__t_1a65172477fcdf1e9f5ba60806284c9004"></span>uint8_t <code class="descname">num_arguments</code><a class="headerlink" href="#c.aprototype_t::num_arguments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_constants">
<span class="target" id="any-vmstructaprototype__t_1adc3fe539bd5295a659d4dadab1c1980b"></span>uint8_t <code class="descname">num_constants</code><a class="headerlink" href="#c.aprototype_t::num_constants" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_local_vars">
<span class="target" id="any-vmstructaprototype__t_1aa858897fe1cc09e55d60d12217776214"></span>uint8_t <code class="descname">num_local_vars</code><a class="headerlink" href="#c.aprototype_t::num_local_vars" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::num_imports">
<span class="target" id="any-vmstructaprototype__t_1adb2da0872efb392be35d59c50757cf65"></span>uint8_t <code class="descname">num_imports</code><a class="headerlink" href="#c.aprototype_t::num_imports" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aprototype_t::resolved">
<span class="target" id="any-vmstructaprototype__t_1a369d390bf49757e55db8acd9f9281e89"></span><a class="reference internal" href="#c.acurrent_t" title="acurrent_t">acurrent_t</a> <code class="descname">resolved</code><a class="headerlink" href="#c.aprototype_t::resolved" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.aimport_t">
<span class="target" id="any-vmstructaimport__t"></span><em class="property">struct </em><code class="descname">aimport_t</code><a class="headerlink" href="#c.aimport_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Function import. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.aimport_t::module">
<span class="target" id="any-vmstructaimport__t_1a8b1a3ebcf568aeec9f4578e4ef98edde"></span>astring_ref_t <code class="descname">module</code><a class="headerlink" href="#c.aimport_t::module" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aimport_t::name">
<span class="target" id="any-vmstructaimport__t_1ad2b8140da451f159206de25a2ea1ed0c"></span>astring_ref_t <code class="descname">name</code><a class="headerlink" href="#c.aimport_t::name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.aimport_t::resolved">
<span class="target" id="any-vmstructaimport__t_1aa69cfdba2916bcfc63baf18fb1d40ab3"></span><a class="reference internal" href="runtime.html#c.avalue_t" title="avalue_t">avalue_t</a> <code class="descname">resolved</code><a class="headerlink" href="#c.aimport_t::resolved" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.acurrent_t">
<span class="target" id="any-vmstructacurrent__t"></span><em class="property">struct </em><code class="descname">acurrent_t</code><a class="headerlink" href="#c.acurrent_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolved prototype pointers. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.acurrent_t::instructions">
<span class="target" id="any-vmstructacurrent__t_1a16dfa6aa34a33679ec8fd90e483e16f7"></span><a class="reference internal" href="#c.ainstruction_t" title="ainstruction_t">ainstruction_t</a>* <code class="descname">instructions</code><a class="headerlink" href="#c.acurrent_t::instructions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.acurrent_t::constants">
<span class="target" id="any-vmstructacurrent__t_1aed9d75c213f3fc753681821d7fa3d913"></span><a class="reference internal" href="runtime.html#c.avalue_t" title="avalue_t">avalue_t</a>* <code class="descname">constants</code><a class="headerlink" href="#c.acurrent_t::constants" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.acurrent_t::imports">
<span class="target" id="any-vmstructacurrent__t_1a334b762ef35d369c64d45c6688b9bb2e"></span><a class="reference internal" href="#c.aimport_t" title="aimport_t">aimport_t</a>* <code class="descname">imports</code><a class="headerlink" href="#c.acurrent_t::imports" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.acurrent_t::nesteds">
<span class="target" id="any-vmstructacurrent__t_1a19bdbd27e9eb4fa62245a944ba6981a9"></span>struct aprototype_s** <code class="descname">nesteds</code><a class="headerlink" href="#c.acurrent_t::nesteds" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

</div>
<div class="section" id="instruction-set">
<h2>Instruction Set<a class="headerlink" href="#instruction-set" title="Permalink to this headline">¶</a></h2>
<dl class="struct">
<dt id="c.ai_base_t">
<span class="target" id="any-vmstructai__base__t"></span><em class="property">struct </em><code class="descname">ai_base_t</code><a class="headerlink" href="#c.ai_base_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Base type. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>opcode</td>
<td>payload</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_base_t::opcode">
<span class="target" id="any-vmstructai__base__t_1adde1d533a26ba0140d4923ef310acd28"></span>uint32_t <code class="descname">opcode</code><a class="headerlink" href="#c.ai_base_t::opcode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_nop_t">
<span class="target" id="any-vmstructai__nop__t"></span><em class="property">struct </em><code class="descname">ai_nop_t</code><a class="headerlink" href="#c.ai_nop_t" title="Permalink to this definition">¶</a></dt>
<dd><p>No operation. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_NOP</td>
<td>_</td>
</tr>
</tbody>
</table>
 </p>
</dd></dl>

<dl class="struct">
<dt id="c.ai_pop_t">
<span class="target" id="any-vmstructai__pop__t"></span><em class="property">struct </em><code class="descname">ai_pop_t</code><a class="headerlink" href="#c.ai_pop_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Pop <code class="docutils literal"><span class="pre">n</span></code> elements from the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_POP</td>
<td>n</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_pop_t::n">
<span class="target" id="any-vmstructai__pop__t_1ab5bad646ad55b96cd0df06b0d0247777"></span>int32_t <code class="descname">n</code><a class="headerlink" href="#c.ai_pop_t::n" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_ldk_t">
<span class="target" id="any-vmstructai__ldk__t"></span><em class="property">struct </em><code class="descname">ai_ldk_t</code><a class="headerlink" href="#c.ai_ldk_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Push a constant from const pool at <code class="docutils literal"><span class="pre">idx</span></code> onto the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_LDK</td>
<td>idx</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_ldk_t::idx">
<span class="target" id="any-vmstructai__ldk__t_1a68bca12206ef20cb8530db39cc213f99"></span>int32_t <code class="descname">idx</code><a class="headerlink" href="#c.ai_ldk_t::idx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_nil_t">
<span class="target" id="any-vmstructai__nil__t"></span><em class="property">struct </em><code class="descname">ai_nil_t</code><a class="headerlink" href="#c.ai_nil_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Push a nil value onto the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_NIL</td>
<td>_</td>
</tr>
</tbody>
</table>
 </p>
</dd></dl>

<dl class="struct">
<dt id="c.ai_ldb_t">
<span class="target" id="any-vmstructai__ldb__t"></span><em class="property">struct </em><code class="descname">ai_ldb_t</code><a class="headerlink" href="#c.ai_ldb_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Push a bool value <code class="docutils literal"><span class="pre">val</span></code> onto the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_LDB</td>
<td>val</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_ldb_t::val">
<span class="target" id="any-vmstructai__ldb__t_1ae953589688d8476ff524e25f5581e551"></span>int32_t <code class="descname">val</code><a class="headerlink" href="#c.ai_ldb_t::val" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_llv_t">
<span class="target" id="any-vmstructai__llv__t"></span><em class="property">struct </em><code class="descname">ai_llv_t</code><a class="headerlink" href="#c.ai_llv_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Push a value from local pool at <code class="docutils literal"><span class="pre">idx</span></code> onto the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_LLV</td>
<td>idx</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_llv_t::idx">
<span class="target" id="any-vmstructai__llv__t_1aa5d3478f86dfa643e251e0e2e22daeed"></span>int32_t <code class="descname">idx</code><a class="headerlink" href="#c.ai_llv_t::idx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_slv_t">
<span class="target" id="any-vmstructai__slv__t"></span><em class="property">struct </em><code class="descname">ai_slv_t</code><a class="headerlink" href="#c.ai_slv_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Pop a value from the stack and set it into the local pool at <code class="docutils literal"><span class="pre">idx</span></code>. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_SLV</td>
<td>idx</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_slv_t::idx">
<span class="target" id="any-vmstructai__slv__t_1aee865793bf8313b5b762358aa62a2a31"></span>int32_t <code class="descname">idx</code><a class="headerlink" href="#c.ai_slv_t::idx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_imp_t">
<span class="target" id="any-vmstructai__imp__t"></span><em class="property">struct </em><code class="descname">ai_imp_t</code><a class="headerlink" href="#c.ai_imp_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Push a value from import pool at <code class="docutils literal"><span class="pre">idx</span></code> onto the stack. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_IMP</td>
<td>idx</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_imp_t::idx">
<span class="target" id="any-vmstructai__imp__t_1a7d99b6d7718079114eece612e637a62d"></span>int32_t <code class="descname">idx</code><a class="headerlink" href="#c.ai_imp_t::idx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_jmp_t">
<span class="target" id="any-vmstructai__jmp__t"></span><em class="property">struct </em><code class="descname">ai_jmp_t</code><a class="headerlink" href="#c.ai_jmp_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Unconditional jump, with signed <code class="docutils literal"><span class="pre">displacement</span></code>. </p>
<p><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_JMP</td>
<td>displacement</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_jmp_t::displacement">
<span class="target" id="any-vmstructai__jmp__t_1a75ff0af39dd9a11b8840d2577989b6bc"></span>int32_t <code class="descname">displacement</code><a class="headerlink" href="#c.ai_jmp_t::displacement" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_jin_t">
<span class="target" id="any-vmstructai__jin__t"></span><em class="property">struct </em><code class="descname">ai_jin_t</code><a class="headerlink" href="#c.ai_jin_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Conditional jump, with signed <code class="docutils literal"><span class="pre">displacement</span></code>. </p>
<p>Pop a boolean value from the stack and jump if it&#8217;s nil or false. <table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_JIN</td>
<td>displacement</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_jin_t::displacement">
<span class="target" id="any-vmstructai__jin__t_1a36b283ddd6ba4e9b10cc9c9e11c35f2a"></span>int32_t <code class="descname">displacement</code><a class="headerlink" href="#c.ai_jin_t::displacement" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_ivk_t">
<span class="target" id="any-vmstructai__ivk__t"></span><em class="property">struct </em><code class="descname">ai_ivk_t</code><a class="headerlink" href="#c.ai_ivk_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Function call. </p>
<p>Pop <code class="docutils literal"><span class="pre">nargs</span></code> arguments and next a closure from the stack then call it. The result will be pushed back onto the stack after that.</p>
<p><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_IVK</td>
<td>nargs</td>
</tr>
</tbody>
</table>
 </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ai_ivk_t::nargs">
<span class="target" id="any-vmstructai__ivk__t_1a57e94a9be7aad2adbbeec689af496b75"></span>int32_t <code class="descname">nargs</code><a class="headerlink" href="#c.ai_ivk_t::nargs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

<dl class="struct">
<dt id="c.ai_ret_t">
<span class="target" id="any-vmstructai__ret__t"></span><em class="property">struct </em><code class="descname">ai_ret_t</code><a class="headerlink" href="#c.ai_ret_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Returning from a function call. </p>
<p>Top of the stack will be returned as result. <table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">8 bits</th>
<th class="head">24 bits</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>AOC_RET</td>
<td>_</td>
</tr>
</tbody>
</table>
 </p>
</dd></dl>

<dl class="union">
<dt id="c.ainstruction_t">
<span class="target" id="any-vmunionainstruction__t"></span><em class="property">union </em><code class="descname">ainstruction_t</code><a class="headerlink" href="#c.ainstruction_t" title="Permalink to this definition">¶</a></dt>
<dd><em>#include &lt;rt_types.h&gt;</em><p>Variant of instruction types, instruction size is fixed 4 bytes. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric">Public Members</p>
<dl class="variable">
<dt id="c.ainstruction_t::b">
<span class="target" id="any-vmunionainstruction__t_1a5efab6dc4811d8a5423e1bb98c217476"></span><a class="reference internal" href="#c.ai_base_t" title="ai_base_t">ai_base_t</a> <code class="descname">b</code><a class="headerlink" href="#c.ainstruction_t::b" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::nop">
<span class="target" id="any-vmunionainstruction__t_1a3d0d351f71c9faa77dda800fa0ae32ad"></span><a class="reference internal" href="#c.ai_nop_t" title="ai_nop_t">ai_nop_t</a> <code class="descname">nop</code><a class="headerlink" href="#c.ainstruction_t::nop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::pop">
<span class="target" id="any-vmunionainstruction__t_1a0f04a792b2c1eae32380ca16e8e5c11a"></span><a class="reference internal" href="#c.ai_pop_t" title="ai_pop_t">ai_pop_t</a> <code class="descname">pop</code><a class="headerlink" href="#c.ainstruction_t::pop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::ldk">
<span class="target" id="any-vmunionainstruction__t_1a5a773a6b03a4447741c2bb873bdcdd6d"></span><a class="reference internal" href="#c.ai_ldk_t" title="ai_ldk_t">ai_ldk_t</a> <code class="descname">ldk</code><a class="headerlink" href="#c.ainstruction_t::ldk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::nil">
<span class="target" id="any-vmunionainstruction__t_1af438eda213abeb824e316f7894fbfc95"></span><a class="reference internal" href="#c.ai_nil_t" title="ai_nil_t">ai_nil_t</a> <code class="descname">nil</code><a class="headerlink" href="#c.ainstruction_t::nil" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::ldb">
<span class="target" id="any-vmunionainstruction__t_1afa401fc9ddd3398324dcb1e29f06a301"></span><a class="reference internal" href="#c.ai_ldb_t" title="ai_ldb_t">ai_ldb_t</a> <code class="descname">ldb</code><a class="headerlink" href="#c.ainstruction_t::ldb" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::llv">
<span class="target" id="any-vmunionainstruction__t_1a2c3cb13c63fdbf3eee539d082925bde9"></span><a class="reference internal" href="#c.ai_llv_t" title="ai_llv_t">ai_llv_t</a> <code class="descname">llv</code><a class="headerlink" href="#c.ainstruction_t::llv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::slv">
<span class="target" id="any-vmunionainstruction__t_1a0874482b7ba0b50e149d1f7997aa3228"></span><a class="reference internal" href="#c.ai_slv_t" title="ai_slv_t">ai_slv_t</a> <code class="descname">slv</code><a class="headerlink" href="#c.ainstruction_t::slv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::imp">
<span class="target" id="any-vmunionainstruction__t_1af30a8d7acdb4c0f9658c3e4bcaf03a73"></span><a class="reference internal" href="#c.ai_imp_t" title="ai_imp_t">ai_imp_t</a> <code class="descname">imp</code><a class="headerlink" href="#c.ainstruction_t::imp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::jmp">
<span class="target" id="any-vmunionainstruction__t_1aebdd8aa814b3df70119f5fc80a54b264"></span><a class="reference internal" href="#c.ai_jmp_t" title="ai_jmp_t">ai_jmp_t</a> <code class="descname">jmp</code><a class="headerlink" href="#c.ainstruction_t::jmp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::jin">
<span class="target" id="any-vmunionainstruction__t_1ae139365e233938e3ad9b6d5efb8d64ba"></span><a class="reference internal" href="#c.ai_jin_t" title="ai_jin_t">ai_jin_t</a> <code class="descname">jin</code><a class="headerlink" href="#c.ainstruction_t::jin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::ivk">
<span class="target" id="any-vmunionainstruction__t_1ab750cbfe8997e7a69bc9b49be874b461"></span><a class="reference internal" href="#c.ai_ivk_t" title="ai_ivk_t">ai_ivk_t</a> <code class="descname">ivk</code><a class="headerlink" href="#c.ainstruction_t::ivk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="variable">
<dt id="c.ainstruction_t::ret">
<span class="target" id="any-vmunionainstruction__t_1a6385d0816eaaad1f47b7b85fe610153c"></span><a class="reference internal" href="#c.ai_ret_t" title="ai_ret_t">ai_ret_t</a> <code class="descname">ret</code><a class="headerlink" href="#c.ainstruction_t::ret" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Bytecode</a><ul>
<li><a class="reference internal" href="#code-chunk">Code Chunk</a></li>
<li><a class="reference internal" href="#function-prototype">Function Prototype</a></li>
<li><a class="reference internal" href="#instruction-set">Instruction Set</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="api.html"
                        title="previous chapter">API Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="runtime.html"
                        title="next chapter">Runtime</a></p>
<div class="sourcelink">
  <a href="_sources/bytecode.rst.txt" rel="nofollow">
    Show page source
  </a>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="api.html" title="Previous document">API Reference</a>
        </li>
        <li>
          <a href="runtime.html" title="Next document">Runtime</a>
          &rarr;
        </li>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="index.html">Any-VM 0.1.0 documentation</a></li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2017 Nguyễn Việt Giang. All rights reserved.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      1.5.5
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>